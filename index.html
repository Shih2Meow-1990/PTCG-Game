<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PTCG 得卡挑戰 | Cloud Nexus v2.3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

        // --- 1. 安全初始化 Firebase ---
        let db, auth, appId;
        let isConfigured = false;

        try {
            // 檢查環境變數是否存在 (Canvas 環境專用)
            if (typeof __firebase_config !== 'undefined') {
                const firebaseConfig = JSON.parse(__firebase_config);
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                isConfigured = true;
            } else {
                console.warn("未偵測到 Firebase 配置。若在 GitHub 使用，請手動填入 config。");
                document.body.insertAdjacentHTML('afterbegin', `
                    <div id="config-error" class="bg-red-500 text-white p-4 text-center text-sm font-bold z-[3000] relative">
                        偵測到環境配置缺失：請確認您已正確設定 Firebase 密鑰。
                    </div>
                `);
            }
        } catch (e) {
            console.error("Firebase Init Error:", e);
        }

        // --- 2. 狀態管理 ---
        let history = [];
        let accounts = ['DANIEL'];
        let user = null;
        let activeAccount = 'DANIEL';
        let activeHourFilter = 'all';
        let activeMonthFilter = 'all';
        let currentMapping = new Array(5).fill(-1);
        let activeSource = -1;

        // UI 元素選取
        const ui = {
            accountTabs: document.getElementById('account-tabs'),
            matrixBody: document.getElementById('matrix-body'),
            hourSelector: document.getElementById('hour-selector'),
            monthSelector: document.getElementById('month-selector'),
            dbCount: document.getElementById('db-count'),
            liveClock: document.getElementById('live-clock'),
            commitBtn: document.getElementById('commit-btn'),
            tooltip: document.getElementById('matrix-tooltip'),
            activeAccountLabel: document.getElementById('active-account-label'),
            activeMonthLabel: document.getElementById('active-month-label'),
            currentAccountDisplay: document.getElementById('current-account-display'),
            statusText: document.getElementById('cloud-status'),
            statusDot: document.getElementById('cloud-status-dot')
        };

        // --- 3. 核心功能函數 (掛載至 window 確保 onclick 可用) ---
        window.selectSource = (idx) => {
            activeSource = idx;
            document.querySelectorAll('[id^="start-"]').forEach(el => el.classList.remove('selected'));
            document.getElementById(`start-${idx}`).classList.add('selected', 'ring-2', 'ring-sky-400');
        };

        window.selectTarget = (idx) => {
            if (activeSource === -1) return;
            currentMapping.forEach((target, src) => { if (target === idx) currentMapping[src] = -1; });
            currentMapping[activeSource] = idx;
            updateMappingUI();
            
            const nextEmpty = currentMapping.findIndex(m => m === -1);
            if (nextEmpty !== -1) window.selectSource(nextEmpty);
            else {
                activeSource = -1;
                document.querySelectorAll('[id^="start-"]').forEach(el => el.classList.remove('selected', 'ring-2', 'ring-sky-400'));
            }
            checkCommitState();
        };

        const updateMappingUI = () => {
            document.querySelectorAll('[id^="end-"]').forEach(el => {
                el.className = "mapping-node text-base font-bold";
                el.innerHTML = parseInt(el.id.split('-')[1]) + 1;
            });
            document.querySelectorAll('[id^="start-"]').forEach((el, i) => {
                const isSelected = activeSource === i;
                el.className = `mapping-node text-base font-bold ${currentMapping[i] !== -1 ? 'color-' + i : ''} ${isSelected ? 'selected ring-2 ring-sky-400' : ''}`;
            });
            currentMapping.forEach((targetIdx, srcIdx) => {
                if (targetIdx !== -1) {
                    const targetEl = document.getElementById(`end-${targetIdx}`);
                    targetEl.classList.add(`color-${srcIdx}`, 'ring-2', 'ring-white/20');
                    targetEl.innerHTML = `<span class="text-[10px] opacity-60 mr-1">S</span>${srcIdx + 1}`;
                }
            });
        };

        const checkCommitState = () => {
            const isFull = currentMapping.every(m => m !== -1);
            if (isFull) {
                ui.commitBtn.disabled = false;
                ui.commitBtn.className = "w-full mt-8 py-6 bg-emerald-500 text-black font-black rounded-3xl text-lg uppercase tracking-widest transition-all cursor-pointer shadow-[0_0_30px_rgba(16,185,129,0.4)] hover:scale-[1.02] active:scale-95";
                ui.commitBtn.innerText = "提交並同步至雲端";
            } else {
                ui.commitBtn.disabled = true;
                ui.commitBtn.className = "w-full mt-8 py-6 bg-slate-800 text-slate-500 font-bold rounded-3xl text-lg uppercase tracking-widest transition-all cursor-not-allowed border border-white/5";
                ui.commitBtn.innerText = "請完成所有對位";
            }
        };

        window.commitMapping = async () => {
            if (!isConfigured || !user) {
                alert("雲端連線未就緒，無法提交。");
                return;
            }
            const now = new Date();
            const logAccount = activeAccount === 'ALL' ? 'DANIEL' : activeAccount;
            const logData = {
                mapping: [...currentMapping],
                t: Date.now(),
                h: now.getHours(),
                m: now.getMonth() + 1,
                y: now.getFullYear(),
                acc: logAccount,
                uid: user.uid
            };

            ui.commitBtn.innerText = "同步中...";
            try {
                await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'logs'), logData);
                window.resetMapping();
            } catch (e) {
                console.error("Upload error", e);
                ui.commitBtn.innerText = "上傳失敗，請重試";
            }
        };

        window.resetMapping = () => {
            currentMapping = new Array(5).fill(-1);
            activeSource = -1;
            updateMappingUI();
            checkCommitState();
        };

        // --- 4. 身份驗證與同步 ---
        if (isConfigured) {
            const initAuth = async () => {
                try {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await signInWithCustomToken(auth, __initial_auth_token);
                    } else {
                        await signInAnonymously(auth);
                    }
                } catch (err) {
                    ui.statusText.innerText = "連線失敗";
                    ui.statusDot.classList.add('bg-red-500');
                }
            };

            onAuthStateChanged(auth, (u) => {
                user = u;
                if (u) {
                    ui.statusText.innerText = "雲端同步中";
                    ui.statusDot.classList.replace('bg-slate-500', 'bg-emerald-500');
                    startDataSync();
                }
            });

            const startDataSync = () => {
                const logsRef = collection(db, 'artifacts', appId, 'public', 'data', 'logs');
                onSnapshot(logsRef, (snapshot) => {
                    history = snapshot.docs.map(doc => doc.data());
                    renderMonthSelector();
                    renderMatrix();
                    ui.dbCount.innerText = history.length;
                    ui.statusText.innerText = "數據已同步";
                });

                const accountsRef = collection(db, 'artifacts', appId, 'public', 'data', 'accounts');
                onSnapshot(accountsRef, (snapshot) => {
                    const cloudAccounts = snapshot.docs.map(doc => doc.data().name);
                    accounts = [...new Set(['DANIEL', ...cloudAccounts])];
                    renderAccountTabs();
                });
            };

            initAuth().then(() => {
                renderHourSelector();
                lucide.createIcons();
            });
        }

        // --- 5. UI 渲染邏輯 ---
        window.setAccount = (acc) => {
            activeAccount = acc;
            ui.activeAccountLabel.innerText = acc;
            ui.currentAccountDisplay.innerText = `紀錄帳號: ${acc === 'ALL' ? 'DANIEL' : acc}`;
            renderAccountTabs();
            renderMatrix();
        };

        window.setHourFilter = (h) => {
            activeHourFilter = h;
            renderHourSelector();
            renderMatrix();
        };

        window.setMonthFilter = (mKey) => {
            activeMonthFilter = mKey;
            ui.activeMonthLabel.innerText = mKey === 'all' ? '全部月份' : mKey;
            renderMonthSelector();
            renderMatrix();
        };

        const renderAccountTabs = () => {
            ui.accountTabs.innerHTML = '';
            ['ALL', ...accounts].forEach(acc => {
                const btn = document.createElement('button');
                btn.className = `tab-btn ${activeAccount === acc ? 'active' : ''}`;
                btn.innerText = acc === 'ALL' ? '全域視角' : acc;
                btn.onclick = () => window.setAccount(acc);
                ui.accountTabs.appendChild(btn);
            });
        };

        const renderHourSelector = () => {
            ui.hourSelector.innerHTML = '';
            for (let i = 0; i < 24; i++) {
                const btn = document.createElement('button');
                btn.className = `filter-btn ${activeHourFilter === i ? 'active' : ''}`;
                btn.innerText = i;
                btn.onclick = () => window.setHourFilter(i);
                ui.hourSelector.appendChild(btn);
            }
        };

        const renderMonthSelector = () => {
            ui.monthSelector.innerHTML = '';
            const availableMonths = [...new Set(history.map(l => `${l.y}-${String(l.m).padStart(2,'0')}`))].sort().reverse();
            availableMonths.forEach(m => {
                const btn = document.createElement('button');
                btn.className = `filter-btn px-4 py-2 ${activeMonthFilter === m ? 'active' : ''}`;
                btn.innerText = m;
                btn.onclick = () => window.setMonthFilter(m);
                ui.monthSelector.appendChild(btn);
            });
        };

        const renderMatrix = () => {
            ui.matrixBody.innerHTML = '';
            let filtered = history;
            if (activeAccount !== 'ALL') filtered = filtered.filter(l => l.acc === activeAccount);
            if (activeHourFilter !== 'all') filtered = filtered.filter(l => l.h === activeHourFilter);
            if (activeMonthFilter !== 'all') {
                const [y, m] = activeMonthFilter.split('-').map(Number);
                filtered = filtered.filter(l => l.y === y && l.m === m);
            }

            let matrix = Array.from({length: 5}, () => new Array(5).fill(0));
            let startTotals = new Array(5).fill(0);

            filtered.forEach(log => {
                log.mapping.forEach((target, src) => {
                    matrix[src][target]++;
                    startTotals[src]++;
                });
            });

            for (let s = 0; s < 5; s++) {
                const header = document.createElement('div');
                header.className = "matrix-cell border-none font-black text-sky-400 text-sm";
                header.innerText = `S${s+1}`;
                ui.matrixBody.appendChild(header);

                for (let r = 0; r < 5; r++) {
                    const count = matrix[s][r];
                    const percent = startTotals[s] > 0 ? (count / startTotals[s]) : 0;
                    const cell = document.createElement('div');
                    let bgClass = "heatmap-low";
                    if (percent >= 0.4) bgClass = "heatmap-high shadow-[0_0_15px_rgba(56,189,248,0.3)]";
                    else if (percent >= 0.2) bgClass = "heatmap-mid";

                    cell.className = `matrix-cell ${count > 0 ? bgClass : ''} rounded-xl text-sm font-bold transition-all duration-300 hover:scale-105 cursor-pointer`;
                    cell.innerHTML = count > 0 ? `${Math.round(percent * 100)}%` : '-';
                    
                    cell.onmouseenter = (e) => {
                        ui.tooltip.style.display = 'block';
                        ui.tooltip.style.left = (e.clientX + 15) + 'px';
                        ui.tooltip.style.top = (e.clientY + 15) + 'px';
                        ui.tooltip.innerHTML = `
                            <div class="space-y-1">
                                <p class="text-emerald-400 font-black uppercase tracking-widest text-xs">集合路徑分析</p>
                                <p class="text-white text-sm font-bold">${s+1} 號位 → ${r+1} 號位</p>
                                <div class="h-px bg-white/10 my-2"></div>
                                <p class="text-slate-400 text-xs">累計樣本: <span class="text-white font-mono">${count}</span></p>
                                <p class="text-slate-500 text-[10px] italic">${activeAccount} | ${activeMonthFilter}</p>
                            </div>
                        `;
                    };
                    cell.onmouseleave = () => ui.tooltip.style.display = 'none';
                    ui.matrixBody.appendChild(cell);
                }
            }
        };

        window.addNewAccount = () => {
            document.getElementById('account-modal').classList.remove('hidden');
            document.getElementById('new-account-name').focus();
        };

        window.closeAccountModal = () => document.getElementById('account-modal').classList.add('hidden');

        window.confirmAddAccount = async () => {
            const name = document.getElementById('new-account-name').value.trim().toUpperCase();
            if (name && !accounts.includes(name) && name !== 'ALL') {
                const accRef = doc(db, 'artifacts', appId, 'public', 'data', 'accounts', name);
                await setDoc(accRef, { name: name });
                window.setAccount(name);
            }
            document.getElementById('new-account-name').value = '';
            window.closeAccountModal();
        };

        // 時鐘更新
        setInterval(() => {
            const now = new Date();
            ui.liveClock.innerText = now.toTimeString().split(' ')[0];
        }, 1000);

    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body {
            background-color: #0f172a; /* 改為較亮的深藍色，提高對比 */
            color: #f1f5f9;
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        .matrix-cell { 
            aspect-ratio: 1; 
            background: rgba(255, 255, 255, 0.03); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }

        /* 加大對位方塊 */
        .mapping-node { 
            width: 56px; 
            height: 76px; 
            background: rgba(255, 255, 255, 0.05); 
            border: 2px solid rgba(255, 255, 255, 0.1); 
            border-radius: 12px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            cursor: pointer; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
        }

        .mapping-node:hover {
            border-color: rgba(56, 189, 248, 0.5);
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .mapping-node.selected { 
            border-color: #38bdf8; 
            background: rgba(56, 189, 248, 0.15); 
            box-shadow: 0 0 25px rgba(56, 189, 248, 0.3); 
        }

        /* 顏色標記 */
        .color-0 { color: #f87171; border-color: #f87171; background: rgba(248, 113, 113, 0.1); }
        .color-1 { color: #fbbf24; border-color: #fbbf24; background: rgba(251, 191, 36, 0.1); }
        .color-2 { color: #34d399; border-color: #34d399; background: rgba(52, 211, 153, 0.1); }
        .color-3 { color: #38bdf8; border-color: #38bdf8; background: rgba(56, 189, 248, 0.1); }
        .color-4 { color: #a855f7; border-color: #a855f7; background: rgba(168, 85, 247, 0.1); }

        /* 標籤樣式 */
        .tab-btn { 
            padding: 12px 24px; 
            font-size: 13px; 
            font-weight: 700;
            text-transform: uppercase; 
            letter-spacing: 1.5px; 
            border-bottom: 3px solid transparent; 
            transition: all 0.3s ease; 
            color: #94a3b8; 
        }
        .tab-btn.active { 
            color: #38bdf8; 
            border-color: #38bdf8; 
            background: rgba(56, 189, 248, 0.05); 
        }

        /* 過濾器按鈕 */
        .filter-btn { 
            padding: 8px 12px; 
            font-size: 12px; 
            font-weight: 600;
            text-align: center; 
            border: 1px solid rgba(255,255,255,0.1); 
            background: rgba(255,255,255,0.03); 
            transition: all 0.2s ease; 
            border-radius: 8px; 
        }
        .filter-btn:hover { background: rgba(255,255,255,0.08); border-color: rgba(255,255,255,0.2); }
        .filter-btn.active { 
            background: #38bdf8; 
            color: #010204; 
            font-weight: 800; 
            border-color: #38bdf8; 
            box-shadow: 0 4px 12px rgba(56, 189, 248, 0.3);
        }

        /* 熱力圖等級 */
        .heatmap-high { background: rgba(56, 189, 248, 0.85); color: #010204; }
        .heatmap-mid { background: rgba(56, 189, 248, 0.4); color: white; }
        .heatmap-low { background: rgba(255, 255, 255, 0.03); color: #64748b; }

        /* 浮窗 */
        #matrix-tooltip { 
            position: fixed; 
            pointer-events: none; 
            background: rgba(15, 23, 42, 0.95); 
            border: 1px solid rgba(56, 189, 248, 0.5); 
            padding: 16px; 
            border-radius: 16px; 
            display: none; 
            z-index: 1000; 
            backdrop-filter: blur(12px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.6); 
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* 動畫 */
        @keyframes pulse-emerald {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }
        .animate-status { animation: pulse-emerald 2s infinite ease-in-out; }
    </style>
</head>
<body class="p-4 md:p-8 flex flex-col items-center min-h-screen">

    <div id="matrix-tooltip"></div>

    <div class="w-full max-w-7xl">
        <!-- 頂部導航 -->
        <nav class="flex items-center gap-2 mb-10 border-b border-white/10 overflow-x-auto no-scrollbar">
            <div id="account-tabs" class="flex"></div>
            <button onclick="addNewAccount()" class="tab-btn hover:text-white flex items-center gap-2">
                <i data-lucide="plus" class="w-4 h-4 text-sky-400"></i> 新增帳號
            </button>
        </nav>

        <!-- 標題 -->
        <header class="text-center mb-14">
            <h1 class="text-5xl font-black italic tracking-tighter text-white uppercase flex items-center justify-center gap-4">
                <i data-lucide="zap" class="text-sky-400 w-10 h-10"></i> PTCG 得卡挑戰 <span class="text-sky-400 font-normal not-italic text-lg ml-2 tracking-[0.5em] opacity-60">| CLOUD v2.3</span>
            </h1>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">
            <!-- 左側操作 -->
            <div class="lg:col-span-5 space-y-8">
                <div class="bg-slate-800/50 p-8 rounded-[3rem] border border-white/10 shadow-2xl backdrop-blur-md">
                    <div class="flex justify-between items-center mb-10">
                        <div>
                            <h3 class="text-xs font-black text-sky-400 uppercase tracking-[0.3em]">位移路徑追蹤系統</h3>
                            <p id="current-account-display" class="text-[10px] text-slate-400 mt-2 uppercase tracking-widest font-bold">當前帳號: Daniel</p>
                        </div>
                        <button onclick="resetMapping()" class="text-[10px] text-slate-400 hover:text-white uppercase px-3 py-2 border border-white/10 rounded-xl hover:bg-white/5 transition-colors">重置路徑</button>
                    </div>

                    <div class="flex flex-col gap-14 items-center relative py-6">
                        <!-- START -->
                        <div class="flex flex-col items-center gap-4 w-full">
                            <span class="text-[10px] text-slate-500 uppercase tracking-[0.4em] font-black">1. 初始位置 (START)</span>
                            <div class="flex justify-between w-full px-4">
                                <div id="start-0" onclick="selectSource(0)" class="mapping-node">1</div>
                                <div id="start-1" onclick="selectSource(1)" class="mapping-node">2</div>
                                <div id="start-2" onclick="selectSource(2)" class="mapping-node">3</div>
                                <div id="start-3" onclick="selectSource(3)" class="mapping-node">4</div>
                                <div id="start-4" onclick="selectSource(4)" class="mapping-node">5</div>
                            </div>
                        </div>

                        <div class="h-px w-full bg-gradient-to-r from-transparent via-white/10 to-transparent relative flex justify-center items-center">
                            <div class="bg-[#0f172a] px-6 py-2 border border-white/10 rounded-full shadow-lg">
                                <i data-lucide="refresh-cw" class="w-5 h-5 text-sky-500"></i>
                            </div>
                        </div>

                        <!-- RESULT -->
                        <div class="flex flex-col items-center gap-4 w-full">
                            <div class="flex justify-between w-full px-4">
                                <div id="end-0" onclick="selectTarget(0)" class="mapping-node">1</div>
                                <div id="end-1" onclick="selectTarget(1)" class="mapping-node">2</div>
                                <div id="end-2" onclick="selectTarget(2)" class="mapping-node">3</div>
                                <div id="end-3" onclick="selectTarget(3)" class="mapping-node">4</div>
                                <div id="end-4" onclick="selectTarget(4)" class="mapping-node">5</div>
                            </div>
                            <span class="text-[10px] text-emerald-400 uppercase tracking-[0.4em] font-black">2. 結果位置 (RESULT)</span>
                        </div>
                    </div>

                    <button id="commit-btn" onclick="commitMapping()" disabled class="w-full mt-8 py-6 bg-slate-800 text-slate-500 font-bold rounded-3xl text-lg uppercase tracking-widest transition-all cursor-not-allowed">等待對位數據</button>
                </div>

                <!-- 儀表板 -->
                <div class="grid grid-cols-2 gap-6">
                    <div class="bg-slate-800/50 p-6 rounded-3xl border border-white/10 flex flex-col justify-center">
                        <div class="flex items-center gap-3 mb-2">
                            <div id="cloud-status-dot" class="w-2.5 h-2.5 rounded-full bg-slate-500 animate-status"></div>
                            <span id="cloud-status" class="text-[10px] text-slate-400 uppercase tracking-widest font-bold">偵測連線...</span>
                        </div>
                        <p id="live-clock" class="text-3xl font-black text-sky-400 tracking-tighter font-mono">00:00:00</p>
                    </div>
                    <div class="bg-slate-800/50 p-6 rounded-3xl border border-white/10 text-right flex flex-col justify-center">
                        <span class="text-[10px] text-slate-500 uppercase tracking-widest font-bold">集體累計樣本數</span>
                        <p id="db-count" class="text-4xl font-black text-white mt-1 font-mono tracking-tighter">0</p>
                    </div>
                </div>
            </div>

            <!-- 右側矩陣 -->
            <div class="lg:col-span-7 space-y-8">
                <div class="bg-slate-800/50 p-8 rounded-[3rem] border border-white/10 shadow-2xl relative overflow-hidden backdrop-blur-md">
                    <div class="flex justify-between items-center mb-10">
                        <h3 class="text-sm font-black text-white uppercase tracking-[0.3em]">時空機率矩陣分析</h3>
                        <div class="flex items-center gap-4">
                            <div class="bg-black/40 px-4 py-2 rounded-2xl border border-white/10 flex items-center gap-3">
                                <i data-lucide="database" class="w-4 h-4 text-sky-400"></i>
                                <span id="active-account-label" class="text-xs text-sky-400 font-black uppercase">Daniel</span>
                            </div>
                            <div class="bg-black/40 px-4 py-2 rounded-2xl border border-white/10 flex items-center gap-3">
                                <i data-lucide="calendar" class="w-4 h-4 text-slate-400"></i>
                                <span id="active-month-label" class="text-xs text-slate-400 font-black uppercase">全部月份</span>
                            </div>
                        </div>
                    </div>

                    <!-- 矩陣容器 -->
                    <div class="grid grid-cols-6 gap-3 mb-12">
                        <div class="matrix-cell border-none text-[10px] text-slate-500 font-black italic">S \ R</div>
                        <div class="matrix-cell border-none text-xs font-black text-slate-400">R1</div>
                        <div class="matrix-cell border-none text-xs font-black text-slate-400">R2</div>
                        <div class="matrix-cell border-none text-xs font-black text-slate-400">R3</div>
                        <div class="matrix-cell border-none text-xs font-black text-slate-400">R4</div>
                        <div class="matrix-cell border-none text-xs font-black text-slate-400">R5</div>
                        <div id="matrix-body" class="contents"></div>
                    </div>

                    <!-- 過濾器 -->
                    <div class="space-y-10 pt-10 border-t border-white/10">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <div class="flex justify-between items-center mb-5">
                                    <span class="text-xs font-black text-slate-500 uppercase tracking-widest">月份過濾</span>
                                    <button onclick="setMonthFilter('all')" class="text-[10px] text-sky-400 underline uppercase font-bold tracking-widest hover:text-white transition-colors">全部顯示</button>
                                </div>
                                <div id="month-selector" class="flex flex-wrap gap-2"></div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center mb-5">
                                    <span class="text-xs font-black text-slate-500 uppercase tracking-widest">時段過濾 (HOUR)</span>
                                    <button onclick="setHourFilter('all')" class="text-[10px] text-sky-400 underline uppercase font-bold tracking-widest hover:text-white transition-colors">全部顯示</button>
                                </div>
                                <div class="grid grid-cols-6 gap-2" id="hour-selector"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer class="mt-20 text-center opacity-30 pb-20">
            <p class="text-[10px] text-slate-500 uppercase tracking-[0.5em] font-black">Collaborative Gacha Intelligence | System v2.3 Terminal</p>
        </footer>
    </div>

    <!-- Modal -->
    <div id="account-modal" class="fixed inset-0 bg-black/90 backdrop-blur-xl hidden z-[2000] flex items-center justify-center p-6">
        <div class="bg-slate-900 border border-white/10 p-10 rounded-[2.5rem] w-full max-w-sm shadow-[0_0_100px_rgba(0,0,0,1)]">
            <h4 class="text-sm font-black text-sky-400 uppercase mb-6 tracking-[0.3em] text-center">註冊團隊成員</h4>
            <input type="text" id="new-account-name" placeholder="輸入代號 (如: ALAN)..." class="w-full bg-black/50 border border-white/10 p-4 rounded-2xl text-sm focus:border-sky-500 outline-none mb-6 text-white text-center font-bold">
            <div class="flex gap-4">
                <button onclick="closeAccountModal()" class="flex-1 py-4 text-xs text-slate-500 uppercase font-black hover:text-white transition-colors">取消</button>
                <button onclick="confirmAddAccount()" class="flex-1 py-4 bg-emerald-500 text-black rounded-2xl text-xs uppercase font-black shadow-lg shadow-emerald-500/20 active:scale-95 transition-transform">加入連線</button>
            </div>
        </div>
    </div>
</body>
</html>
